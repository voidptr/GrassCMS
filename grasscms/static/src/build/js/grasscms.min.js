(function(){var j,b,n,h,d,c,p,r,l,g,o,m,f,k,i,e,q,a;r=function(t,s){($("#menu"))[0].dataset.currentTarget=$(t).attr("id");($("#menu")).css("top",s[1]-35);($("#menu")).css("left",s[0]-30);($("#menu")).show();return false};i=function(s){return($(s)).on("click",function(t){if(t.button===0&&t.target.parentNode.id!=="#menu"){return $("#menu").css("display","none")}})};g=function(u){var t,s;t=u.dataTransfer.files;s=new FileReader();console.log(t[0]);console.log(s);s.onload=function(v){var w;w=$("<img>");w.attr("src",v.target.result);w.addClass("persistentGrassy");($("body")).append(w);return($(w)).PersistentGrass()};s.readAsDataURL(t[0]);return q(u)};q=function(s){s.preventDefault();return s.stopPropagation()};($("#filediv")).on("drop",g);($("#filediv")).on("dragenter",q);($("#filediv")).on("dragover",q);($("#filediv")).on("dragexit",q);window.dragSrc=null;j=(function(){function s(u,t){this.element_=u;this.options=$.extend({},t);this.element=$(this.element_);this.init()}s.prototype.init=function(){var u,t;t=$("<ul></ul>");t.html((function(){var y,w,x,v;x=this.options.structure;v=[];for(y=0,w=x.length;y<w;y++){u=x[y];v.push(create_li(u))}return v}).call(this));return t};s.prototype.create_li=function(u){var t;t=$("<li></li>");return t.html('<a href=#><span onclick="this.location.href="/page/by_id/'+u.id+'""> '+u.name+' <i class=icon-remove onclick="delete_page('+u.id+');> </i>"</a>')};s.prototype.create_structure=function(t){return"foo"};return s})();(function(s){return s.fn.PageEditor=function(u){var v,t;if(u==null){u=""}return t=(function(){var z,x,y,w;y=this.children();w=[];for(z=0,x=y.length;z<x;z++){v=y[z];w.push(new j(v,u))}return w}).call(this)}})($);c=function(){($("#y")).on("input",p);($("#y")).on("change",p);return($("#y")).on("blur",p)};p=function(s){console.log(this);return console.log("foo")};a=function(s){($("#width")).val(((s.css("width")).split("px"))[0]);($("#height")).val(((s.css("height")).split("px"))[0]);($("#y")).val(((s.css("top")).split("px"))[0]);return($("#x")).val(((s.css("left")).split("px"))[0])};e=function(s){($("#opacitypicker")).on("change",function(){if(o()){return o().css("opacity",$("#opacitypicker").val())}});return($("#colorpicker")).on("change",function(){if($("#panel_left").data("current_element")){return o().css("background",$("#colorpicker").val())}else{return $("body").css("background",$("#colorpicker").val())}})};window.changed=p;q=function(s){s.stopPropagation();return s.preventDefault()};f=function(){var s;s=o();($(s)).attr("draggable",true);return($(s)).removeClass("editor_active")};k=function(w,v,s,t){var u;s=$("#"+s);u=Number(($(s)).css(w));if(u==="auto"||!u){u=0}if(v==="-1"){v=u+1}if(v==="+1"){v=u+1}($(s)).css(w,v);if(t){$(s).parent().css(w,v)}return $(s).trigger("changed",w,v)};m=function(s){return $(s).parent().parent()[0].dataset.currentTarget};l=function(s,t){if(t==null){t=False}$(s).trigger("changed","delete");$(s).trigger("clear");if(t){$("#"+s).parent().remove()}return $("#"+s).remove()};o=function(){return $("#"+$("#panel_left")[0].dataset.current_element)};q=function(s){s.preventDefault();return s.stopPropagation()};window.stopPropagation=q;window.getCurrentElement=o;window.delete_=l;window.setCss=k;window.recover_mobility=f;window.getFromMenu=m;window.drop=g;h=(function(){function s(w,u){var v,y,t,x;this.element=w;this.langs=["Enter URL","Enter Image URL"];this.button_creator=[{editor_remove_format:[{tag:"removeFormat",format:"",name:'<i title="Remove format in selection" class="icon-remove"></i>'}]},{editor_formatting:[{tag:"bold",format:"",name:'<i title="Bold" class="icon-bold"></i>'},{tag:"underline",format:"",name:'<i title="Underline" class="icon-underline"></i>'},{tag:"strikeThrough",format:"",name:'<i title="Strike Trough" class="icon-strikethrough"></i>'}]},{editor_sub:[{tag:"subscript",format:"",name:'T<sub title="subscript">x</sub>'},{tag:"superscript",format:"",name:'T<sup title="superscript">x</sub>'}]},{editor_lists:[{tag:"insertUnorderedList",format:"",name:'<b title="Unordered list" class=icon-list-ul></b>'},{tag:"insertOrderedList",format:"",name:'<b title="Ordered list" class=icon-list-ol></b>'}]},{editor_indentation:[{tag:"indent",format:"",name:'<b class=icon-indent-left title="Indent"></b>'},{tag:"outdent",format:"",name:'<b class=icon-indent-right title="Outdent"></b>'}]},{editor_justify:[{tag:"justifyLeft",format:"",name:'<i title="Align left" class="icon-align-left"></i>'},{tag:"justifyCenter",format:"",name:'<i class="icon-align-center" title="Center"></i>'},{tag:"justifyRight",format:"",name:'<i class="icon-align-right" title="Align right"></i>'}]},{select:[{tag:"formatBlock",format:"p",name:"Paragraph"},{tag:"formatBlock",format:"h1",name:"Header"},{tag:"formatBlock",format:"h2",name:"Header 2"},{tag:"formatBlock",format:"h3",name:"Header 3"}]},{select:[{tag:"fontName",format:"Arial",name:"Arial"},{tag:"fontName",format:"Helvetica",name:"Helvetica"},{tag:"fontName",format:"Times",name:"Times"},{tag:"fontName",format:"Courier",name:"Courier"}]}];x=this.button_creator;for(y=0,t=x.length;y<t;y++){v=x[y];this.create_button(v)}($(".editor_button")).on("click",this.execcmd);($(".editor_nav")).on("change",this.execcmd)}s.prototype.create_group=function(t,v){var w,u;u="<div class='editor_group "+t+"'>";for(w in v){u+='<a href=# class=editor_button data-format="'+v[w]["format"]+'" data-tag="'+v[w]["tag"]+'"  >'+v[w]["name"]+"</a>"}u+="</div>";return u};s.prototype.create_select=function(u){var v,t;t="<select class='editor_nav'>";for(v in u){t+='<option data-format="'+u[v]["format"]+'" data-tag="'+u[v]["tag"]+'"  >'+u[v]["name"]+"</option>"}t+="</select>";return t};s.prototype.create_button=function(w){var v,u,t;if(w.tag){u='<a class="editor_button" href="#" data-format="'+w.format+'" data-tag="'+w.tag+'"  >'+w.name+"</a>"}else{for(t in w){v=w[t];console.log(t,v)}if(t!=="select"){for(t in w){v=w[t];u=this.create_group(t,v)}}if(t==="select"){for(t in w){v=w[t];u=this.create_select(v)}}}return this.element.prepend(u)};s.prototype.execcmd=function(u){var v,t,w;w=u.target;if(($(w)).is("select")){w=w[w.selectedIndex]}else{if(!($(w)).is("a")){w=($(w)).parent()[0]}else{if(!($(w)).is("a")){w=($(w)).parent()[0]}}}t=w.dataset.tag;console.log(w);v=w.dataset.format;if(t==="createlink"||t==="insertImage"){v=prompt(this.langs[t])}if(v){return document.execCommand(t,false,v)}return document.execCommand(t,false)};return s})();(function(s){return s.fn.simpleHtml5Editor=function(){var t;return t=new h(this)}})($);b=(function(){function s(u,t){this.element_=u;this.options=$.extend({},t);this.element=$(this.element_);this.init()}s.prototype.init=function(){this.do_resizable();this.assign_events();return($(".textGrassy")).on("DOMNodeInserted DOMSubtreeModified DOMNodeRemoved",this.changed)};s.prototype.do_resizable=function(){var t,u;u=this.element.css("width")!=="0px"?this.element.css("width"):"100px";t=this.element.css("height")!=="0px"?this.element.css("height"):"100px";this.element.css("width","100%");this.element.css("height","100%");return this.element=(($(this.element_)).wrap('<div style="width:'+u+"; height:"+t+'" class="resizable" data-offset="'+this.options.offset+'">')).parent()};s.prototype.assign_events=function(){var v,x,u,w,t;$(".control_div").on("click",this.clear);w=["toolbar_updated","clear","mouseover","drag","mouseout","dblclick","contextmenu","dragstart","dragend","click","changed"];t=[];for(x=0,u=w.length;x<u;x++){v=w[x];t.push(this.element.on(v,this[v]))}return t};s.prototype.click=function(v){var A,z,t,w,x,u,y;stopPropagation(v);x=$(v.target);u=($(v.target)).children()[0];z=($(x)).attr("id");x.trigger("toolbar_updated",v);if(!z&&($(u)).attr("id")){z=($(u)).attr("id")}if(!z){return}($(".simpleHtml5Editor")).hide();f();$("#panel_left")[0].dataset.current_element=z;if(o().css("opacity")){$("#opacitypicker").val(o().css("opacity"))}else{$("#opacitypicker").val(1)}t=($(x)).children("img");A=($(x)).children("div");if(t[0]){w=((($(x)).children("img")).attr("src")).split("/");y=w[w.length-1]}else{if(A[0]){y="Text element"}else{if(($(x)).is("img")){w=(($(x)).attr("src")).split("/");y=w[w.length-1]}else{if(($(x)).is("div")){y="Text element"}}}}($(".show_on_element")).show();($(".hide_on_element")).hide();return($("#current_element_name")).html(y)};s.prototype.dblclick=function(t){var u;stopPropagation(t);u=$(t.target);if(!u.hasClass("textGrassy")){return}u.attr("contentEditable","true");u.attr("draggable","false");u.addClass("editor_active");($("#editor")).show();return($("#toggle_editing")).hide()};s.prototype.clear=function(t){($(".simpleHtml5Editor")).hide();f();($("#toggle_editing")).show();($(".show_on_element")).hide();($(".hide_on_element")).show();($("#current_element_name")).html("");return($("#panel_left"))[0].dataset.current_element=false};s.prototype.mouseover=function(t){stopPropagation(t);return($(this)).toggleClass("selectedObject")};s.prototype.contextmenu=function(t){return r($(t.target),[t.x,t.y])};s.prototype.mouseout=function(u){var t;stopPropagation(u);($(this)).toggleClass("selectedObject");if(($(this)).attr("id")){t=$(this)}else{if(!($(($(this)).children()[0])).attr("id")){return}t=$(($(this)).children()[0])}if(t.css("height"!==t.data("height"))){t.trigger("changed",["height",this.style.height]);t.data("height",t.css("height"))}if(t.css("width"!==t[0].dataset.width)){t.trigger("changed",["width",this.style.width]);return t.data("width",t.css("width"))}};s.prototype.toolbar_updated=function(t){var u;u=$(t.target);if(($(t.target)).hasClass("persistentGrassy")){u=($(t.target)).parent()}return a(u)};s.prototype.dragstart=function(t){t.dataTransfer.setData("Text",this.id);$(this).trigger("click");this.dataset.opacity=this.style.opacity?this.style.opacity:1;return this.style.opacity=0.4};s.prototype.drag=function(t){$(t.target).trigger("toolbar_updated");this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;if(t.x>this.dataset.offset){this.style.left=t.x-this.dataset.offset+"px"}this.style.top=t.y+"px";this.style.position="absolute";return stopPropagation(t)};s.prototype.dragend=function(t){this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;$(this).trigger("changed",["top",t.y]);return $(this).trigger("changed",["left",t.x])};s.prototype.changed=function(v,u,t){var x,w;if(!v.target.css){w=($(v.target)).parent()}else{w=$(v.target)}w.trigger("toolbar_updated");x=w.attr("id");return $.ajax("/object/",{type:"PUT",dataType:"json",data:JSON.stringify({id:x,attr:u,result:t})})};return s})();(function(s){return s.fn.PersistentGrass=function(t){var u,v;if(t==null){t={offset:250}}return v=(function(){var y,x,w;w=[];for(y=0,x=this.length;y<x;y++){u=this[y];w.push(new b(u,t))}return w}).call(this)}})($);n=(function(){function s(u,t){this.element=u;($(this.element)).attr("draggable","true");this.element[0].dataset.movement=t;($(this.element)).on("dragstart",this.dragstart);($(this.element)).on("drag",this.drag);($(this.element)).on("dragend",this.dragend)}s.prototype.dragstart=function(u){var t;if(this.dataset.clone!=="true"){this.dataset.clone="true";t=($(this)).clone().appendTo("body");t[0].dataset.clone="false";($(t)).css("z-index",0);($(this)).css("z-index",1);return($(t)).Ruler(this.dataset.movement)}};s.prototype.drag=function(t){if(this.dataset.movement==="x"){if(t.x>250){return this.style.left=t.x+"px"}}else{return this.style.top=t.y+"px"}};s.prototype.dragend=function(t){return this.style.opacity=1};return s})();(function(s){return s.fn.Ruler=function(t){var u;if(t==null){t="y"}return u=new n(this,t)}})($);d=(function(){function s(u,t){this.element_=u;this.options=$.extend({},t);this.element=$(this.element_);this.init()}s.prototype.init=function(){return this.assign_events()};s.prototype.assign_events=function(){var v,x,u,w,t;w=["dragstart","dragend","dragover","drop","dragenter","dragleave"];t=[];for(x=0,u=w.length;x<u;x++){v=w[x];t.push(this.element.on(v,this[v]))}return t};s.prototype.dragover=function(t){t.preventDefault();t.dataTransfer.dropEffect="move"};s.prototype.dblclick=function(t){};s.prototype.drop=function(t){console.log(window.dragSrc);this.classList.remove("page_editor_over");($(window.dragSrc)).css("opacity",1);window.dragSrc.innerHTML=this.innerHTML;this.innerHTML=t.dataTransfer.getData("text/html")};s.prototype.dragstart=function(t){($(this)).css("opacity",0.2);t.dataTransfer.effectAllowed="move";t.dataTransfer.setData("text/html",this.innerHTML);window.dragSrc=this};s.prototype.dragenter=function(t){return this.classList.add("page_editor_over")};s.prototype.dragleave=function(t){return this.classList.remove("page_editor_over")};s.prototype.dragend=function(t){};return s})();(function(s){return s.fn.Sortable=function(t){var u,v;if(t==null){t=""}return v=(function(){var z,x,y,w;y=this.children();w=[];for(z=0,x=y.length;z<x;z++){u=y[z];w.push(new d(u,t))}return w}).call(this)}})($);($(document)).ready(function(){i(document);e("body");c();$("#page_editor").children(":not(.no-drag)").Sortable();($("#editor")).simpleHtml5Editor();($(".persistentGrassy")).PersistentGrass();($(".rect-x")).Ruler("x");return($(".rect-y")).Ruler("y")})}).call(this);