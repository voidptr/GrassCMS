(function(){var k,c,o,i,e,b,d,r,t,m,q,h,p,n,g,l,j,f,s,a;t=function(v,u){($("#menu"))[0].dataset.currentTarget=$(v).attr("id");($("#menu")).css("top",u[1]-35);($("#menu")).css("left",u[0]-30);($("#menu")).show();return false};j=function(u){return($(u)).on("click",function(v){if(v.button===0&&v.target.parentNode.id!=="#menu"){return $("#menu").css("display","none")}})};h=function(w){var v,u;v=w.dataTransfer.files;u=new FileReader();console.log(v[0]);console.log(u);u.onload=function(x){var y;y=$("<img>");y.attr("src",x.target.result);y.addClass("persistentGrassy");($("body")).append(y);return($(y)).PersistentGrass()};u.readAsDataURL(v[0]);return s(w)};s=function(u){u.preventDefault();return u.stopPropagation()};($("#filediv")).on("drop",h);($("#filediv")).on("dragenter",s);($("#filediv")).on("dragover",s);($("#filediv")).on("dragexit",s);window.dragSrc=null;k=(function(){function u(w,v){this.element_=w;this.options=$.extend({},v);this.element=$(this.element_);this.init()}u.prototype.init=function(){var w,v;v=$("<ul></ul>");v.html((function(){var A,y,z,x;z=this.options.structure;x=[];for(A=0,y=z.length;A<y;A++){w=z[A];x.push(create_li(w))}return x}).call(this));return v};u.prototype.create_li=function(w){var v;v=$("<li></li>");return v.html('<a href=#><span onclick="this.location.href="/page/by_id/'+w.id+'""> '+w.name+' <i class=icon-remove onclick="delete_page('+w.id+');> </i>"</a>')};u.prototype.create_structure=function(v){return"foo"};return u})();(function(u){return u.fn.PageEditor=function(w){var x,v;if(w==null){w=""}return v=(function(){var B,z,A,y;A=this.children();y=[];for(B=0,z=A.length;B<z;B++){x=A[B];y.push(new k(x,w))}return y}).call(this)}})($);b=function(w){var x,z,v,y,u;y=["input","change","blur"];u=[];for(z=0,v=y.length;z<v;z++){x=y[z];u.push(w.on(x,r))}return u};d=function(){var w,y,v,x,u;x=["#top","#left","#width","#height"];u=[];for(y=0,v=x.length;y<v;y++){w=x[y];u.push(b($(w)))}return u};r=function(u){return($(p().parent())).css(this.id,this.value)};a=function(u){($("#width")).val(((u.css("width")).split("px"))[0]);($("#height")).val(((u.css("height")).split("px"))[0]);($("#top")).val(((u.css("top")).split("px"))[0]);return($("#left")).val(((u.css("left")).split("px"))[0])};f=function(u){($("#opacitypicker")).on("change",function(){if(p()){return p().css("opacity",$("#opacitypicker").val())}});($("#colorpicker")).on("change",function(){if(p()){return p().css("background",$("#colorpicker").val())}else{return $("body").css("background",$("#colorpicker").val())}});return($("#cssclasses")).on("change",function(){var v,y,w,x;x=this.value.split(",");for(y=0,w=x.length;y<w;y++){v=x[y];($(p())).addClass(v)}return($(p())).trigger("changed",["cssclasses",this.value])})};window.changed=r;s=function(u){u.stopPropagation();return u.preventDefault()};g=function(){var u;u=p();($(u)).attr("draggable",true);return($(u)).removeClass("editor_active")};l=function(y,x,u,v){var w;u=$("#"+u);w=Number(($(u)).css(y));if(w==="auto"||!w){w=0}if(x==="-1"){x=w+1}if(x==="+1"){x=w+1}($(u)).css(y,x);if(v){$(u).parent().css(y,x)}return $(u).trigger("changed",y,x)};n=function(u){return $(u).parent().parent()[0].dataset.currentTarget};m=function(u,v){if(v==null){v=False}$(u).trigger("changed","delete");$(u).trigger("clear");if(v){$("#"+u).parent().remove()}return $("#"+u).remove()};p=function(){return $("#"+$("#panel_left")[0].dataset.current_element)};s=function(u){u.preventDefault();return u.stopPropagation()};window.stopPropagation=s;window.getCurrentElement=p;window.delete_=m;window.setCss=l;window.recover_mobility=g;window.getFromMenu=n;window.drop=h;i=(function(){function u(y,w){var x,A,v,z;this.element=y;this.langs=["Enter URL","Enter Image URL"];this.button_creator=[{editor_remove_format:[{tag:"removeFormat",format:"",name:'<i title="Remove format in selection" class="icon-remove"></i>'}]},{editor_formatting:[{tag:"bold",format:"",name:'<i title="Bold" class="icon-bold"></i>'},{tag:"underline",format:"",name:'<i title="Underline" class="icon-underline"></i>'},{tag:"strikeThrough",format:"",name:'<i title="Strike Trough" class="icon-strikethrough"></i>'}]},{editor_sub:[{tag:"subscript",format:"",name:'T<sub title="subscript">x</sub>'},{tag:"superscript",format:"",name:'T<sup title="superscript">x</sub>'}]},{editor_lists:[{tag:"insertUnorderedList",format:"",name:'<b title="Unordered list" class=icon-list-ul></b>'},{tag:"insertOrderedList",format:"",name:'<b title="Ordered list" class=icon-list-ol></b>'}]},{editor_indentation:[{tag:"indent",format:"",name:'<b class=icon-indent-left title="Indent"></b>'},{tag:"outdent",format:"",name:'<b class=icon-indent-right title="Outdent"></b>'}]},{editor_justify:[{tag:"justifyLeft",format:"",name:'<i title="Align left" class="icon-align-left"></i>'},{tag:"justifyCenter",format:"",name:'<i class="icon-align-center" title="Center"></i>'},{tag:"justifyRight",format:"",name:'<i class="icon-align-right" title="Align right"></i>'}]},{select:[{tag:"formatBlock",format:"p",name:"Paragraph"},{tag:"formatBlock",format:"h1",name:"Header"},{tag:"formatBlock",format:"h2",name:"Header 2"},{tag:"formatBlock",format:"h3",name:"Header 3"}]},{select:[{tag:"fontName",format:"Arial",name:"Arial"},{tag:"fontName",format:"Helvetica",name:"Helvetica"},{tag:"fontName",format:"Times",name:"Times"},{tag:"fontName",format:"Courier",name:"Courier"}]}];z=this.button_creator;for(A=0,v=z.length;A<v;A++){x=z[A];this.create_button(x)}($(".editor_button")).on("click",this.execcmd);($(".editor_nav")).on("change",this.execcmd)}u.prototype.create_group=function(v,x){var y,w;w="<div class='editor_group "+v+"'>";for(y in x){w+='<a href=# class=editor_button data-format="'+x[y]["format"]+'" data-tag="'+x[y]["tag"]+'"  >'+x[y]["name"]+"</a>"}w+="</div>";return w};u.prototype.create_select=function(w){var x,v;v="<select class='editor_nav'>";for(x in w){v+='<option data-format="'+w[x]["format"]+'" data-tag="'+w[x]["tag"]+'"  >'+w[x]["name"]+"</option>"}v+="</select>";return v};u.prototype.create_button=function(y){var x,w,v;if(y.tag){w='<a class="editor_button" href="#" data-format="'+y.format+'" data-tag="'+y.tag+'"  >'+y.name+"</a>"}else{for(v in y){x=y[v];console.log(v,x)}if(v!=="select"){for(v in y){x=y[v];w=this.create_group(v,x)}}if(v==="select"){for(v in y){x=y[v];w=this.create_select(x)}}}return this.element.prepend(w)};u.prototype.execcmd=function(w){var x,v,y;y=w.target;if(($(y)).is("select")){y=y[y.selectedIndex]}else{if(!($(y)).is("a")){y=($(y)).parent()[0]}else{if(!($(y)).is("a")){y=($(y)).parent()[0]}}}v=y.dataset.tag;console.log(y);x=y.dataset.format;if(v==="createlink"||v==="insertImage"){x=prompt(this.langs[v])}if(x){return document.execCommand(v,false,x)}return document.execCommand(v,false)};return u})();(function(u){return u.fn.simpleHtml5Editor=function(){var v;return v=new i(this)}})($);q=function(u){window.current_x=u.pageX;return window.current_y=u.pageY};window.dragover=q;c=(function(){function u(w,v){this.element_=w;this.options=$.extend({},v);this.element=$(this.element_);this.init()}u.prototype.init=function(){this.do_resizable();this.assign_events();return($(".textGrassy")).on("DOMNodeInserted DOMSubtreeModified DOMNodeRemoved",this.changed)};u.prototype.do_resizable=function(){var v,w;w=this.element.css("width")!=="0px"?this.element.css("width"):"100px";v=this.element.css("height")!=="0px"?this.element.css("height"):"100px";this.element.css("width","100%");this.element.css("height","100%");return this.element=(($(this.element_)).wrap('<div draggable=true style="position:absolute; width:'+w+"; height:"+v+'" class="resizable" data-offset="'+this.options.offset+'">')).parent()};u.prototype.assign_events=function(){var x,z,w,y,v;$(".control_div").on("click",this.clear);y=["toolbar_updated","clear","mouseover","drag","mouseout","dblclick","contextmenu","dragstart","dragend","click","changed"];v=[];for(z=0,w=y.length;z<w;z++){x=y[z];v.push(this.element.on(x,this[x]))}return v};u.prototype.click=function(x){var C,B,v,y,z,w,A;stopPropagation(x);z=$(x.target);w=($(x.target)).children()[0];B=($(z)).attr("id");z.trigger("toolbar_updated",x);if(!B&&($(w)).attr("id")){B=($(w)).attr("id")}if(!B){return}($(".simpleHtml5Editor")).hide();g();$("#panel_left")[0].dataset.current_element=B;if(p().css("opacity")){$("#opacitypicker").val(p().css("opacity"))}else{$("#opacitypicker").val(1)}v=($(z)).children("img");C=($(z)).children("div");if(v[0]){y=((($(z)).children("img")).attr("src")).split("/");A=y[y.length-1]}else{if(C[0]){A="Text element"}else{if(($(z)).is("img")){y=(($(z)).attr("src")).split("/");A=y[y.length-1]}else{if(($(z)).is("div")){A="Text element"}}}}($(".show_on_element")).show();($(".hide_on_element")).hide();return($("#current_element_name")).html(A)};u.prototype.dblclick=function(v){var w;stopPropagation(v);w=$(v.target);if(!w.hasClass("textGrassy")){return}w.attr("contentEditable","true");w.attr("draggable","false");w.addClass("editor_active");($("#editor")).show();return($("#toggle_editing")).hide()};u.prototype.clear=function(v){($(".simpleHtml5Editor")).hide();g();($("#toggle_editing")).show();($(".show_on_element")).hide();($(".hide_on_element")).show();($("#current_element_name")).html("");return($("#panel_left"))[0].dataset.current_element=false};u.prototype.mouseover=function(v){stopPropagation(v);return($(this)).toggleClass("selectedObject")};u.prototype.contextmenu=function(v){return t($(v.target),[v.x,v.y])};u.prototype.mouseout=function(w){var v;stopPropagation(w);($(this)).toggleClass("selectedObject");if(($(this)).attr("id")){v=$(this)}else{if(!($(($(this)).children()[0])).attr("id")){return}v=$(($(this)).children()[0])}if(!($(this)).id!==p().id){return}if(v.css("height"!==v.data("height"))){v.trigger("changed",["height",this.style.height]);v.data("height",v.css("height"))}if(v.css("width"!==v[0].dataset.width)){v.trigger("changed",["width",this.style.width]);return v.data("width",v.css("width"))}};u.prototype.toolbar_updated=function(v){var w;w=$(v.target);if(($(v.target)).hasClass("persistentGrassy")){w=($(v.target)).parent()}return a(w)};u.prototype.dragstart=function(v){v.dataTransfer.setData("Text",this.id);$(this).trigger("click");this.dataset.opacity=this.style.opacity?this.style.opacity:1;return this.style.opacity=0.4};u.prototype.drag=function(v){$(v.target).trigger("toolbar_updated");this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;if(v.x>this.dataset.offset){this.style.left=v.x-this.dataset.offset+"px"}this.style.top=v.y+"px";if(!v.y&&!v.x){this.style.left=window.current_x-this.dataset.offset+"px";this.style.top=window.current_y+"px"}return stopPropagation(v)};u.prototype.dragend=function(v){this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;$(this).trigger("changed",["top",v.y]);return $(this).trigger("changed",["left",v.x])};u.prototype.changed=function(x,w,v){var z,y;if(!x.target.css){y=($(x.target)).parent()}else{y=$(x.target)}y.trigger("toolbar_updated");z=y.attr("id");return $.ajax("/object/",{type:"PUT",dataType:"json",data:JSON.stringify({id:z,attr:w,result:v})})};return u})();(function(u){return u.fn.PersistentGrass=function(v){var w,x;if(v==null){v={offset:250}}return x=(function(){var A,z,y;y=[];for(A=0,z=this.length;A<z;A++){w=this[A];y.push(new c(w,v))}return y}).call(this)}})($);o=(function(){function u(w,v){this.element=w;($(this.element)).attr("draggable","true");this.element[0].dataset.movement=v;($(this.element)).on("dragstart",this.dragstart);($(this.element)).on("drag",this.drag);($(this.element)).on("dragend",this.dragend)}u.prototype.dragstart=function(w){var v;if(this.dataset.clone!=="true"){this.dataset.clone="true";v=($(this)).clone().appendTo("body");v[0].dataset.clone="false";($(v)).css("z-index",0);($(this)).css("z-index",1);return($(v)).Ruler(this.dataset.movement)}};u.prototype.drag=function(v){if(this.dataset.movement==="x"){if(v.x>250){return this.style.left=v.x+"px"}}else{return this.style.top=v.y+"px"}};u.prototype.dragend=function(v){return this.style.opacity=1};return u})();(function(u){return u.fn.Ruler=function(v){var w;if(v==null){v="y"}return w=new o(this,v)}})($);e=(function(){function u(w,v){this.element_=w;this.options=$.extend({},v);this.element=$(this.element_);this.init()}u.prototype.init=function(){return this.assign_events()};u.prototype.assign_events=function(){var x,z,w,y,v;y=["dragstart","dragend","dragover","drop","dragenter","dragleave"];v=[];for(z=0,w=y.length;z<w;z++){x=y[z];v.push(this.element.on(x,this[x]))}return v};u.prototype.dragover=function(v){v.preventDefault();v.dataTransfer.dropEffect="move"};u.prototype.dblclick=function(v){};u.prototype.drop=function(v){console.log(window.dragSrc);this.classList.remove("page_editor_over");($(window.dragSrc)).css("opacity",1);window.dragSrc.innerHTML=this.innerHTML;this.innerHTML=v.dataTransfer.getData("text/html")};u.prototype.dragstart=function(v){($(this)).css("opacity",0.2);v.dataTransfer.effectAllowed="move";v.dataTransfer.setData("text/html",this.innerHTML);window.dragSrc=this};u.prototype.dragenter=function(v){return this.classList.add("page_editor_over")};u.prototype.dragleave=function(v){return this.classList.remove("page_editor_over")};u.prototype.dragend=function(v){};return u})();(function(u){return u.fn.Sortable=function(v){var w,x;if(v==null){v=""}return x=(function(){var B,z,A,y;A=this.children();y=[];for(B=0,z=A.length;B<z;B++){w=A[B];y.push(new e(w,v))}return y}).call(this)}})($);($(document)).ready(function(){j(document);f("body");d();($(document)).on("dragover",q);$("#page_editor").children(":not(.no-drag)").Sortable();($("#editor")).simpleHtml5Editor();($(".persistentGrassy")).PersistentGrass();($(".rect-x")).Ruler("x");return($(".rect-y")).Ruler("y")})}).call(this);