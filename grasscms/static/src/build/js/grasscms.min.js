(function(){var k,c,o,i,e,b,d,q,s,m,h,p,n,g,l,j,f,r,a;s=function(u,t){($("#menu"))[0].dataset.currentTarget=$(u).attr("id");($("#menu")).css("top",t[1]-35);($("#menu")).css("left",t[0]-30);($("#menu")).show();return false};j=function(t){return($(t)).on("click",function(u){if(u.button===0&&u.target.parentNode.id!=="#menu"){return $("#menu").css("display","none")}})};h=function(v){var u,t;u=v.dataTransfer.files;t=new FileReader();console.log(u[0]);console.log(t);t.onload=function(w){var x;x=$("<img>");x.attr("src",w.target.result);x.addClass("persistentGrassy");($("body")).append(x);return($(x)).PersistentGrass()};t.readAsDataURL(u[0]);return r(v)};r=function(t){t.preventDefault();return t.stopPropagation()};($("#filediv")).on("drop",h);($("#filediv")).on("dragenter",r);($("#filediv")).on("dragover",r);($("#filediv")).on("dragexit",r);window.dragSrc=null;k=(function(){function t(v,u){this.element_=v;this.options=$.extend({},u);this.element=$(this.element_);this.init()}t.prototype.init=function(){var v,u;u=$("<ul></ul>");u.html((function(){var z,x,y,w;y=this.options.structure;w=[];for(z=0,x=y.length;z<x;z++){v=y[z];w.push(create_li(v))}return w}).call(this));return u};t.prototype.create_li=function(v){var u;u=$("<li></li>");return u.html('<a href=#><span onclick="this.location.href="/page/by_id/'+v.id+'""> '+v.name+' <i class=icon-remove onclick="delete_page('+v.id+');> </i>"</a>')};t.prototype.create_structure=function(u){return"foo"};return t})();(function(t){return t.fn.PageEditor=function(v){var w,u;if(v==null){v=""}return u=(function(){var A,y,z,x;z=this.children();x=[];for(A=0,y=z.length;A<y;A++){w=z[A];x.push(new k(w,v))}return x}).call(this)}})($);b=function(v){var w,y,u,x,t;x=["input","change","blur"];t=[];for(y=0,u=x.length;y<u;y++){w=x[y];t.push(v.on(w,q))}return t};d=function(){var v,x,u,w,t;w=["#top","#left","#width","#height"];t=[];for(x=0,u=w.length;x<u;x++){v=w[x];t.push(b($(v)))}return t};q=function(t){return($(p().parent())).css(this.id,this.value)};a=function(t){($("#width")).val(((t.css("width")).split("px"))[0]);($("#height")).val(((t.css("height")).split("px"))[0]);($("#top")).val(((t.css("top")).split("px"))[0]);return($("#left")).val(((t.css("left")).split("px"))[0])};f=function(t){($("#opacitypicker")).on("change",function(){if(p()){return p().css("opacity",$("#opacitypicker").val())}});($("#colorpicker")).on("change",function(){if(p()){return p().css("background",$("#colorpicker").val())}else{return $("body").css("background",$("#colorpicker").val())}});return($("#cssclasses")).on("change",function(){var u,x,v,w;w=this.value.split(",");for(x=0,v=w.length;x<v;x++){u=w[x];($(p())).addClass(u)}return($(p())).trigger("changed",["cssclasses",this.value])})};window.changed=q;r=function(t){t.stopPropagation();return t.preventDefault()};g=function(){var t;t=p();($(t)).attr("draggable",true);return($(t)).removeClass("editor_active")};l=function(x,w,t,u){var v;t=$("#"+t);v=Number(($(t)).css(x));if(v==="auto"||!v){v=0}if(w==="-1"){w=v+1}if(w==="+1"){w=v+1}($(t)).css(x,w);if(u){$(t).parent().css(x,w)}return $(t).trigger("changed",x,w)};n=function(t){return $(t).parent().parent()[0].dataset.currentTarget};m=function(t,u){if(u==null){u=False}$(t).trigger("changed","delete");$(t).trigger("clear");if(u){$("#"+t).parent().remove()}return $("#"+t).remove()};p=function(){return $("#"+$("#panel_left")[0].dataset.current_element)};r=function(t){t.preventDefault();return t.stopPropagation()};window.stopPropagation=r;window.getCurrentElement=p;window.delete_=m;window.setCss=l;window.recover_mobility=g;window.getFromMenu=n;window.drop=h;i=(function(){function t(x,v){var w,z,u,y;this.element=x;this.langs=["Enter URL","Enter Image URL"];this.button_creator=[{editor_remove_format:[{tag:"removeFormat",format:"",name:'<i title="Remove format in selection" class="icon-remove"></i>'}]},{editor_formatting:[{tag:"bold",format:"",name:'<i title="Bold" class="icon-bold"></i>'},{tag:"underline",format:"",name:'<i title="Underline" class="icon-underline"></i>'},{tag:"strikeThrough",format:"",name:'<i title="Strike Trough" class="icon-strikethrough"></i>'}]},{editor_sub:[{tag:"subscript",format:"",name:'T<sub title="subscript">x</sub>'},{tag:"superscript",format:"",name:'T<sup title="superscript">x</sub>'}]},{editor_lists:[{tag:"insertUnorderedList",format:"",name:'<b title="Unordered list" class=icon-list-ul></b>'},{tag:"insertOrderedList",format:"",name:'<b title="Ordered list" class=icon-list-ol></b>'}]},{editor_indentation:[{tag:"indent",format:"",name:'<b class=icon-indent-left title="Indent"></b>'},{tag:"outdent",format:"",name:'<b class=icon-indent-right title="Outdent"></b>'}]},{editor_justify:[{tag:"justifyLeft",format:"",name:'<i title="Align left" class="icon-align-left"></i>'},{tag:"justifyCenter",format:"",name:'<i class="icon-align-center" title="Center"></i>'},{tag:"justifyRight",format:"",name:'<i class="icon-align-right" title="Align right"></i>'}]},{select:[{tag:"formatBlock",format:"p",name:"Paragraph"},{tag:"formatBlock",format:"h1",name:"Header"},{tag:"formatBlock",format:"h2",name:"Header 2"},{tag:"formatBlock",format:"h3",name:"Header 3"}]},{select:[{tag:"fontName",format:"Arial",name:"Arial"},{tag:"fontName",format:"Helvetica",name:"Helvetica"},{tag:"fontName",format:"Times",name:"Times"},{tag:"fontName",format:"Courier",name:"Courier"}]}];y=this.button_creator;for(z=0,u=y.length;z<u;z++){w=y[z];this.create_button(w)}($(".editor_button")).on("click",this.execcmd);($(".editor_nav")).on("change",this.execcmd)}t.prototype.create_group=function(u,w){var x,v;v="<div class='editor_group "+u+"'>";for(x in w){v+='<a href=# class=editor_button data-format="'+w[x]["format"]+'" data-tag="'+w[x]["tag"]+'"  >'+w[x]["name"]+"</a>"}v+="</div>";return v};t.prototype.create_select=function(v){var w,u;u="<select class='editor_nav'>";for(w in v){u+='<option data-format="'+v[w]["format"]+'" data-tag="'+v[w]["tag"]+'"  >'+v[w]["name"]+"</option>"}u+="</select>";return u};t.prototype.create_button=function(x){var w,v,u;if(x.tag){v='<a class="editor_button" href="#" data-format="'+x.format+'" data-tag="'+x.tag+'"  >'+x.name+"</a>"}else{for(u in x){w=x[u];console.log(u,w)}if(u!=="select"){for(u in x){w=x[u];v=this.create_group(u,w)}}if(u==="select"){for(u in x){w=x[u];v=this.create_select(w)}}}return this.element.prepend(v)};t.prototype.execcmd=function(v){var w,u,x;x=v.target;if(($(x)).is("select")){x=x[x.selectedIndex]}else{if(!($(x)).is("a")){x=($(x)).parent()[0]}else{if(!($(x)).is("a")){x=($(x)).parent()[0]}}}u=x.dataset.tag;console.log(x);w=x.dataset.format;if(u==="createlink"||u==="insertImage"){w=prompt(this.langs[u])}if(w){return document.execCommand(u,false,w)}return document.execCommand(u,false)};return t})();(function(t){return t.fn.simpleHtml5Editor=function(){var u;return u=new i(this)}})($);c=(function(){function t(v,u){this.element_=v;this.options=$.extend({},u);this.element=$(this.element_);this.init()}t.prototype.init=function(){this.do_resizable();this.assign_events();return($(".textGrassy")).on("DOMNodeInserted DOMSubtreeModified DOMNodeRemoved",this.changed)};t.prototype.do_resizable=function(){var u,v;v=this.element.css("width")!=="0px"?this.element.css("width"):"100px";u=this.element.css("height")!=="0px"?this.element.css("height"):"100px";this.element.css("width","100%");this.element.css("height","100%");return this.element=(($(this.element_)).wrap('<div style="position:absolute; width:'+v+"; height:"+u+'" class="resizable" data-offset="'+this.options.offset+'">')).parent()};t.prototype.assign_events=function(){var w,y,v,x,u;$(".control_div").on("click",this.clear);x=["toolbar_updated","clear","mouseover","drag","mouseout","dblclick","contextmenu","dragstart","dragend","click","changed"];u=[];for(y=0,v=x.length;y<v;y++){w=x[y];u.push(this.element.on(w,this[w]))}return u};t.prototype.click=function(w){var B,A,u,x,y,v,z;stopPropagation(w);y=$(w.target);v=($(w.target)).children()[0];A=($(y)).attr("id");y.trigger("toolbar_updated",w);if(!A&&($(v)).attr("id")){A=($(v)).attr("id")}if(!A){return}($(".simpleHtml5Editor")).hide();g();$("#panel_left")[0].dataset.current_element=A;if(p().css("opacity")){$("#opacitypicker").val(p().css("opacity"))}else{$("#opacitypicker").val(1)}u=($(y)).children("img");B=($(y)).children("div");if(u[0]){x=((($(y)).children("img")).attr("src")).split("/");z=x[x.length-1]}else{if(B[0]){z="Text element"}else{if(($(y)).is("img")){x=(($(y)).attr("src")).split("/");z=x[x.length-1]}else{if(($(y)).is("div")){z="Text element"}}}}($(".show_on_element")).show();($(".hide_on_element")).hide();return($("#current_element_name")).html(z)};t.prototype.dblclick=function(u){var v;stopPropagation(u);v=$(u.target);if(!v.hasClass("textGrassy")){return}v.attr("contentEditable","true");v.attr("draggable","false");v.addClass("editor_active");($("#editor")).show();return($("#toggle_editing")).hide()};t.prototype.clear=function(u){($(".simpleHtml5Editor")).hide();g();($("#toggle_editing")).show();($(".show_on_element")).hide();($(".hide_on_element")).show();($("#current_element_name")).html("");return($("#panel_left"))[0].dataset.current_element=false};t.prototype.mouseover=function(u){stopPropagation(u);return($(this)).toggleClass("selectedObject")};t.prototype.contextmenu=function(u){return s($(u.target),[u.x,u.y])};t.prototype.mouseout=function(v){var u;stopPropagation(v);($(this)).toggleClass("selectedObject");if(($(this)).attr("id")){u=$(this)}else{if(!($(($(this)).children()[0])).attr("id")){return}u=$(($(this)).children()[0])}if(!($(this)).id!==p().id){return}if(u.css("height"!==u.data("height"))){u.trigger("changed",["height",this.style.height]);u.data("height",u.css("height"))}if(u.css("width"!==u[0].dataset.width)){u.trigger("changed",["width",this.style.width]);return u.data("width",u.css("width"))}};t.prototype.toolbar_updated=function(u){var v;v=$(u.target);if(($(u.target)).hasClass("persistentGrassy")){v=($(u.target)).parent()}return a(v)};t.prototype.dragstart=function(u){u.dataTransfer.setData("Text",this.id);$(this).trigger("click");this.dataset.opacity=this.style.opacity?this.style.opacity:1;return this.style.opacity=0.4};t.prototype.drag=function(u){$(u.target).trigger("toolbar_updated");this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;if(u.x>this.dataset.offset){this.style.left=u.x-this.dataset.offset+"px"}this.style.top=u.y+"px";return stopPropagation(u)};t.prototype.dragend=function(u){this.style.opacity=this.dataset.opacity>0?this.dataset.opacity:1;$(this).trigger("changed",["top",u.y]);return $(this).trigger("changed",["left",u.x])};t.prototype.changed=function(w,v,u){var y,x;if(!w.target.css){x=($(w.target)).parent()}else{x=$(w.target)}x.trigger("toolbar_updated");y=x.attr("id");return $.ajax("/object/",{type:"PUT",dataType:"json",data:JSON.stringify({id:y,attr:v,result:u})})};return t})();(function(t){return t.fn.PersistentGrass=function(u){var v,w;if(u==null){u={offset:250}}return w=(function(){var z,y,x;x=[];for(z=0,y=this.length;z<y;z++){v=this[z];x.push(new c(v,u))}return x}).call(this)}})($);o=(function(){function t(v,u){this.element=v;($(this.element)).attr("draggable","true");this.element[0].dataset.movement=u;($(this.element)).on("dragstart",this.dragstart);($(this.element)).on("drag",this.drag);($(this.element)).on("dragend",this.dragend)}t.prototype.dragstart=function(v){var u;if(this.dataset.clone!=="true"){this.dataset.clone="true";u=($(this)).clone().appendTo("body");u[0].dataset.clone="false";($(u)).css("z-index",0);($(this)).css("z-index",1);return($(u)).Ruler(this.dataset.movement)}};t.prototype.drag=function(u){if(this.dataset.movement==="x"){if(u.x>250){return this.style.left=u.x+"px"}}else{return this.style.top=u.y+"px"}};t.prototype.dragend=function(u){return this.style.opacity=1};return t})();(function(t){return t.fn.Ruler=function(u){var v;if(u==null){u="y"}return v=new o(this,u)}})($);e=(function(){function t(v,u){this.element_=v;this.options=$.extend({},u);this.element=$(this.element_);this.init()}t.prototype.init=function(){return this.assign_events()};t.prototype.assign_events=function(){var w,y,v,x,u;x=["dragstart","dragend","dragover","drop","dragenter","dragleave"];u=[];for(y=0,v=x.length;y<v;y++){w=x[y];u.push(this.element.on(w,this[w]))}return u};t.prototype.dragover=function(u){u.preventDefault();u.dataTransfer.dropEffect="move"};t.prototype.dblclick=function(u){};t.prototype.drop=function(u){console.log(window.dragSrc);this.classList.remove("page_editor_over");($(window.dragSrc)).css("opacity",1);window.dragSrc.innerHTML=this.innerHTML;this.innerHTML=u.dataTransfer.getData("text/html")};t.prototype.dragstart=function(u){($(this)).css("opacity",0.2);u.dataTransfer.effectAllowed="move";u.dataTransfer.setData("text/html",this.innerHTML);window.dragSrc=this};t.prototype.dragenter=function(u){return this.classList.add("page_editor_over")};t.prototype.dragleave=function(u){return this.classList.remove("page_editor_over")};t.prototype.dragend=function(u){};return t})();(function(t){return t.fn.Sortable=function(u){var v,w;if(u==null){u=""}return w=(function(){var A,y,z,x;z=this.children();x=[];for(A=0,y=z.length;A<y;A++){v=z[A];x.push(new e(v,u))}return x}).call(this)}})($);($(document)).ready(function(){j(document);f("body");d();$("#page_editor").children(":not(.no-drag)").Sortable();($("#editor")).simpleHtml5Editor();($(".persistentGrassy")).PersistentGrass();($(".rect-x")).Ruler("x");return($(".rect-y")).Ruler("y")})}).call(this);